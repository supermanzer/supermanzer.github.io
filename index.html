<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Supermanzer Data Viz</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">
        <style media="screen">
            header {
                background-image: linear-gradient( 180deg, #79F1A4 10%, #0E5C9C 100%);
            }
            h2.no-um {
                margin-top: 0em;
            }
            h5.no-bm {
                margin-bottom: 0px;
            }
            body {
                font: 12px sans-serif;
            }
            hr.header {
                margin-top: 0px;
                 height: 12px; border: 0; box-shadow: inset 0 12px 12px -12px rgba(0, 0, 0, 0.5);
            }
            hr.section-header {
                border: 0; height: 1px; background-image: linear-gradient(to left, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));
            }
            a {
                text-decoration: underline;
            }
        </style>
    </head>
    <body>
        <main>
            <div class="container">
                <header class="z-depth-4">
                    <h2 class="no-um">Supermanzer Showcase</h2>
                    <h5 class="no-bm">The initial test of Github pages for <a href="https://github.com/supermanzer">Supermanzer</a> </h5>

                </header>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col s12">
                        <!-- D3 Plotting Section -->
                        <section>
                            <h5>Data Visualizations</h5>
                            <p>As I am very excited and interested in visualizing data and seek a more engaging and accessible platform for this work than scientific publication, web development using the D3 library seems like a good fit.</p>
                            <p>Since my recent scientific work has been concerned with the oceanography of the Monterey Bay, that is what I will be focusing on for these visualizations.</p>
                            <p><strong>I am finding the parsing of NDBC text files cumbersome in Javascript.  To that end I will be employing a Python class I am in the process of building.  These efforts can be tracked in the repository for this project, <a href="https://github.com/supermanzer/supermanzer.github.io">here</a> </strong> </p>
                            <hr class="section-header">
                            <h6>Monterey Bay Regional Data Buoy - <a href="http://www.ndbc.noaa.gov/station_page.php?station=46042">NDBC 46042</a></h6>
                            <svg id="wind_hist" width="760" height="500">

                            </svg>
                        </section>
                        <button id="test_url" type="button" name="button">Click to Test URL actions</button>
                        <div class="valid_url">

                        </div>
                    </div>
                </div>
            </div>


        </main>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="d3-scale-chromatic.js">
        </script>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>
         <script src="NDBC.js"></script>
         <script type="text/javascript">
            var btn = document.querySelector('#test_url')
            btn.onclick = function(){
                let url = getLastFullMonthURL();
                let mydiv = document.querySelector('div.valid_url');
                mydiv.texContent = url;
            }
            function getMonthName(mNum) {
                mNames = ['January', 'February', 'March', "April", 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                return mNames[mNum]
            }
            // Defining which directions are upwelling and downwelling favorable

             // Have updated data to columnar format.  This will require different parsing.
             d3.json("stdmet.json", function(error, data) {
                 if (error) {
                     throw error;
                 }
                 columns = Object.keys(data);

                 for (var i = 0; i < columns.length; i++) {
                     k = columns[i];
                     if (i === 0) {
                         var time = Object.keys(data[k]).map(x => new Date(x));
                         data['time'] = time;
                     }
                     data[k] = Object.values(data[k]).map(x => +x);
                 }
                 var values = data;

                 var txtTitle = 'Histogram of Wind Direction for ' + getMonthName(data['time'][20].getMonth()) + " " + data['time'][20].getFullYear();

                 var formatCount = d3.format(",.0f");

                 var svg = d3.select("svg#wind_hist"),
                 margin = {top: 10, right: 30, bottom: 30, left: 30},
                 width = +svg.attr("width") - margin.left - margin.right,
                 height = +svg.attr("height") - margin.top - margin.bottom,
                 g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                 var max = d3.max(values.WDIR);
                 var min = d3.min(values.WDIR);
                 var x = d3.scaleLinear()
                     .domain([min, max])
                     .range([0, width ]);

                 var data = d3.histogram()
                     .domain(x.domain())
                     .thresholds(x.ticks(20))
                     (values.WDIR);

                 var yMax = d3.max(data, function(d){return d.length});
                 var yMin = d3.min(data, function(d){return d.length});
                 var colorScale = d3.scaleSequential(d3.interpolateYlGnBu)
                        .domain([-20, yMax]);

                 var y = d3.scaleLinear()
                     .domain([0, yMax])
                     .range([height, 0]);

                 var bar = g.selectAll('.bar')
                    .data(data)
                    .enter().append("g")
                        .attr("class", "bar")
                        .attr('transform',function(d){return  'translate(' + x(d.x0) + ',' + y(d.length) + ')'});

                bar.append("rect")
                    .attr("x",1)
                    .attr("width", x(data[0].x1) - x(data[0].x0) - 1)
                    .attr("height", function(d) {return height - y(d.length);})
                    .attr("fill", function(d){return colorScale(d.length)});



                svg.append('text')
                    .attr("x", (width/2))
                    .attr("y", 20)
                    .attr("text-anchor", "middle")
                    .attr("class", "graph-title")
                    .text(txtTitle);

                g.append("g")
                    .attr("class", "axis axis--x")
                    .attr('transform', 'translate(0,' + height + ')')
                    .call(d3.axisBottom(x));

                g.append("g")
                    .call(d3.axisLeft(y));
             });








         </script>
    </body>
</html>
